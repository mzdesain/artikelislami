<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Blog Islami</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"><!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script><!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
        @font-face {
            font-family: 'Kemenag';
            src: url('https://cdn.jsdelivr.net/gh/warungpintar/fonts/kemenag.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        body {
            box-sizing: border-box;
            font-family: system-ui, -apple-system, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .sidebar {
            background: linear-gradient(180deg, #059669 0%, #047857 100%);
        }

        .nav-item {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 3px solid white;
        }

        .card {
            transition: all 0.25s ease;
            border: 1px solid #e5e7eb;
        }

        .card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .stat-card {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }

        .toolbar-btn {
            padding: 0.4rem;
            border: 1px solid #d1d5db;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 34px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        @media (min-width: 768px) {
            .toolbar-btn {
                padding: 0.5rem;
                min-width: 40px;
                font-size: 1rem;
            }
        }

        .toolbar-btn:hover {
            background: #f3f4f6;
            border-color: #059669;
        }

        .toolbar-btn.active {
            background: #d1fae5;
            border-color: #059669;
            color: #047857;
        }

        .content-editor {
            min-height: 250px;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            outline: none;
            font-family: 'EB Garamond', serif;
            font-size: 1rem;
            line-height: 1.7;
        }

        @media (min-width: 768px) {
            .content-editor {
                min-height: 300px;
                padding: 1rem;
                font-size: 1.1rem;
                line-height: 1.8;
            }
        }

        .content-editor:focus {
            border-color: #059669;
            box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
        }

        .arabic-text {
            font-family: 'Kemenag', 'Traditional Arabic', 'Arial', sans-serif;
            direction: rtl;
            text-align: right;
            line-height: 2;
            font-size: 1.5em;
        }

        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .status-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.65rem;
            border-radius: 9999px;
            font-weight: 600;
        }

        @media (min-width: 768px) {
            .status-badge {
                font-size: 0.75rem;
                padding: 0.25rem 0.75rem;
            }
        }

        .status-published {
            background: #d1fae5;
            color: #047857;
        }

        .status-draft {
            background: #fef3c7;
            color: #92400e;
        }

        .mobile-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 40;
            display: none;
        }

        .mobile-overlay.active {
            display: block;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -100%;
                transition: left 0.3s ease;
                z-index: 50;
                height: 100%;
            }
            
            .sidebar.mobile-open {
                left: 0;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gray-50">
  <div class="w-full h-full flex overflow-auto"><!-- Mobile Overlay -->
   <div id="mobile-overlay" class="mobile-overlay" onclick="toggleSidebar()"></div><!-- Sidebar -->
   <aside id="sidebar" class="sidebar w-64 flex-shrink-0 text-white overflow-y-auto">
    <div class="p-6">
     <div class="flex items-center gap-3 mb-8">
      <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center"><i class="fas fa-mosque text-xl"></i>
      </div>
      <div>
       <h1 class="text-lg font-bold">Blog Islami</h1>
       <p class="text-xs text-white text-opacity-80">Admin Panel</p>
      </div>
     </div>
     <nav class="space-y-2">
      <div class="nav-item active px-4 py-3 rounded-lg flex items-center gap-3" onclick="showView('dashboard')"><i class="fas fa-chart-line w-5"></i> <span class="font-medium">Dashboard</span>
      </div>
      <div class="nav-item px-4 py-3 rounded-lg flex items-center gap-3" onclick="showView('articles')"><i class="fas fa-newspaper w-5"></i> <span class="font-medium">Artikel</span>
      </div>
      <div class="nav-item px-4 py-3 rounded-lg flex items-center gap-3" onclick="showView('comments')"><i class="fas fa-comments w-5"></i> <span class="font-medium">Komentar</span>
      </div>
     </nav>
    </div>
   </aside><!-- Main Content -->
   <main class="flex-1 overflow-auto"><!-- Header -->
    <header class="bg-white border-b border-gray-200 px-4 md:px-6 py-3 md:py-4">
     <div class="flex items-center justify-between">
      <div class="flex items-center gap-3 md:gap-4"><button onclick="toggleSidebar()" class="md:hidden text-gray-600"> <i class="fas fa-bars text-lg md:text-xl"></i> </button>
       <h2 id="page-title" class="text-lg md:text-xl font-bold text-gray-900">Dashboard</h2>
      </div>
      <div class="flex items-center gap-2 md:gap-3">
       <div class="text-right hidden sm:block">
        <p class="text-xs md:text-sm font-semibold text-gray-900">Admin</p>
        <p class="text-xs text-gray-500">Administrator</p>
       </div>
       <div class="w-8 h-8 md:w-10 md:h-10 bg-green-100 rounded-full flex items-center justify-center"><i class="fas fa-user text-green-600 text-sm md:text-base"></i>
       </div>
      </div>
     </div>
    </header>
    <div class="p-4 md:p-6"><!-- Dashboard View -->
     <div id="dashboard-view" class="fade-in"><!-- Stats Grid -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 mb-6 md:mb-8">
       <div class="stat-card rounded-lg p-4 md:p-6 text-white">
        <div class="flex items-center justify-between mb-3 md:mb-4">
         <div class="w-10 h-10 md:w-12 md:h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center"><i class="fas fa-newspaper text-lg md:text-xl"></i>
         </div>
        </div>
        <p class="text-2xl md:text-3xl font-bold mb-1" id="stat-total-articles">0</p>
        <p class="text-xs md:text-sm text-white text-opacity-90">Total Artikel</p>
       </div>
       <div class="stat-card rounded-lg p-4 md:p-6 text-white">
        <div class="flex items-center justify-between mb-3 md:mb-4">
         <div class="w-10 h-10 md:w-12 md:h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center"><i class="fas fa-check-circle text-lg md:text-xl"></i>
         </div>
        </div>
        <p class="text-2xl md:text-3xl font-bold mb-1" id="stat-published">0</p>
        <p class="text-xs md:text-sm text-white text-opacity-90">Dipublikasikan</p>
       </div>
       <div class="stat-card rounded-lg p-4 md:p-6 text-white">
        <div class="flex items-center justify-between mb-3 md:mb-4">
         <div class="w-10 h-10 md:w-12 md:h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center"><i class="fas fa-eye text-lg md:text-xl"></i>
         </div>
        </div>
        <p class="text-2xl md:text-3xl font-bold mb-1" id="stat-views">0</p>
        <p class="text-xs md:text-sm text-white text-opacity-90">Total Views</p>
       </div>
       <div class="stat-card rounded-lg p-4 md:p-6 text-white">
        <div class="flex items-center justify-between mb-3 md:mb-4">
         <div class="w-10 h-10 md:w-12 md:h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center"><i class="fas fa-comment text-lg md:text-xl"></i>
         </div>
        </div>
        <p class="text-2xl md:text-3xl font-bold mb-1" id="stat-comments">0</p>
        <p class="text-xs md:text-sm text-white text-opacity-90">Total Komentar</p>
       </div>
      </div><!-- Recent Articles -->
      <div class="bg-white rounded-lg border border-gray-200 p-4 md:p-6">
       <h3 class="text-base md:text-lg font-bold text-gray-900 mb-4">Artikel Terbaru</h3>
       <div id="recent-articles" class="space-y-3"><!-- Recent articles will be rendered here -->
       </div>
      </div>
     </div><!-- Articles View -->
     <div id="articles-view" class="hidden">
      <div class="flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3 mb-6">
       <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3"><select id="status-filter" onchange="filterArticles()" class="px-3 py-2 border border-gray-300 rounded-lg text-xs md:text-sm focus:outline-none focus:border-green-600"> <option value="all">Semua Status</option> <option value="published">Published</option> <option value="draft">Draft</option> </select> <select id="category-filter-admin" onchange="filterArticles()" class="px-3 py-2 border border-gray-300 rounded-lg text-xs md:text-sm focus:outline-none focus:border-green-600"> <option value="all">Semua Kategori</option> <option value="Aqidah">Aqidah</option> <option value="Fiqih">Fiqih</option> <option value="Akhlak">Akhlak</option> <option value="Kisah">Kisah Inspiratif</option> </select>
       </div><button onclick="showEditor('new')" class="bg-green-600 text-white px-4 py-2 rounded-lg text-xs md:text-sm font-medium hover:bg-green-700 transition flex items-center justify-center gap-2"> <i class="fas fa-plus"></i> <span>Tambah Artikel</span> </button>
      </div>
      <div id="articles-list" class="space-y-3 md:space-y-4"><!-- Articles will be rendered here -->
      </div>
     </div><!-- Editor View -->
     <div id="editor-view" class="hidden">
      <div class="bg-white rounded-lg border border-gray-200 p-4 md:p-6 mb-6">
       <div class="flex items-center justify-between mb-4 md:mb-6">
        <h3 class="text-lg md:text-xl font-bold text-gray-900" id="editor-title">Tambah Artikel Baru</h3><button onclick="closeEditor()" class="text-gray-600 hover:text-gray-900"> <i class="fas fa-times text-lg md:text-xl"></i> </button>
       </div>
       <form id="article-form" onsubmit="handleSaveArticle(event)">
        <div class="space-y-4 md:space-y-5"><!-- Title -->
         <div><label for="article-title" class="block text-xs md:text-sm font-semibold text-gray-700 mb-2">Judul Artikel</label> <input type="text" id="article-title" required class="w-full px-3 md:px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-green-600" placeholder="Masukkan judul artikel">
         </div><!-- Category & Author -->
         <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
          <div><label for="article-category" class="block text-xs md:text-sm font-semibold text-gray-700 mb-2">Kategori</label> <select id="article-category" required class="w-full px-3 md:px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-green-600"> <option value="">Pilih Kategori</option> <option value="Aqidah">Aqidah</option> <option value="Fiqih">Fiqih</option> <option value="Akhlak">Akhlak</option> <option value="Kisah">Kisah Inspiratif</option> </select>
          </div>
          <div><label for="article-author" class="block text-xs md:text-sm font-semibold text-gray-700 mb-2">Penulis</label> <input type="text" id="article-author" required class="w-full px-3 md:px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-green-600" placeholder="Nama penulis">
          </div>
         </div><!-- Excerpt -->
         <div><label for="article-excerpt" class="block text-xs md:text-sm font-semibold text-gray-700 mb-2">Ringkasan</label> <textarea id="article-excerpt" required rows="2" class="w-full px-3 md:px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-green-600" placeholder="Ringkasan singkat artikel (ditampilkan di daftar artikel)"></textarea>
         </div><!-- Thumbnail URL -->
         <div><label for="article-thumbnail" class="block text-xs md:text-sm font-semibold text-gray-700 mb-2">Thumbnail Gambar (Opsional)</label> <input type="url" id="article-thumbnail" class="w-full px-3 md:px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-green-600" placeholder="https://drive.google.com/...">
          <p class="text-xs text-gray-500 mt-1.5"><i class="fas fa-info-circle"></i> Paste link Google Drive atau link gambar lainnya. Untuk Google Drive: klik kanan gambar → Bagikan → Salin link</p>
          <div id="thumbnail-preview" class="hidden mt-3 border border-gray-200 rounded-lg p-2">
           <p class="text-xs font-semibold text-gray-700 mb-2">Preview:</p><img id="thumbnail-preview-img" src="" alt="Preview" class="w-full h-48 object-cover rounded" onerror="this.parentElement.classList.add('hidden')">
          </div>
         </div><!-- Content with Toolbar -->
         <div><label class="block text-xs md:text-sm font-semibold text-gray-700 mb-2">Konten Artikel</label> <!-- Formatting Toolbar -->
          <div class="border border-gray-300 rounded-t-lg bg-gray-50 p-1.5 md:p-2 flex flex-wrap gap-1 overflow-x-auto"><!-- Text Formatting --> <button type="button" class="toolbar-btn rounded" onclick="formatText('bold')" title="Bold (Ctrl+B)"> <i class="fas fa-bold"></i> </button> <button type="button" class="toolbar-btn rounded" onclick="formatText('italic')" title="Italic (Ctrl+I)"> <i class="fas fa-italic"></i> </button> <button type="button" class="toolbar-btn rounded" onclick="formatText('underline')" title="Underline (Ctrl+U)"> <i class="fas fa-underline"></i> </button>
           <div class="w-px bg-gray-300 mx-0.5 md:mx-1"></div><!-- Text Alignment --> <button type="button" class="toolbar-btn rounded" onclick="formatText('justifyLeft')" title="Rata Kiri"> <i class="fas fa-align-left"></i> </button> <button type="button" class="toolbar-btn rounded" onclick="formatText('justifyCenter')" title="Rata Tengah"> <i class="fas fa-align-center"></i> </button> <button type="button" class="toolbar-btn rounded" onclick="formatText('justifyRight')" title="Rata Kanan"> <i class="fas fa-align-right"></i> </button> <button type="button" class="toolbar-btn rounded" onclick="formatText('justifyFull')" title="Rata Kiri-Kanan (Justify)"> <i class="fas fa-align-justify"></i> </button>
           <div class="w-px bg-gray-300 mx-0.5 md:mx-1"></div><!-- Lists --> <button type="button" class="toolbar-btn rounded" onclick="formatText('insertUnorderedList')" title="Bullet List"> <i class="fas fa-list-ul"></i> </button> <button type="button" class="toolbar-btn rounded" onclick="formatText('insertOrderedList')" title="Numbered List"> <i class="fas fa-list-ol"></i> </button>
          </div><!-- Content Editor -->
          <div id="article-content" contenteditable="true" class="content-editor" style="border-top: none; border-top-left-radius: 0; border-top-right-radius: 0;">
           <p>Tulis konten artikel di sini...</p>
          </div>
          <p class="text-xs text-gray-500 mt-2"><i class="fas fa-info-circle"></i> Tips: Gunakan toolbar untuk format teks. Untuk teks Arab, pastikan menggunakan rata kanan.</p>
         </div><!-- Status -->
         <div><label for="article-status" class="block text-xs md:text-sm font-semibold text-gray-700 mb-2">Status</label> <select id="article-status" required class="w-full px-3 md:px-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-green-600"> <option value="draft">Draft</option> <option value="published">Publish</option> </select>
         </div><!-- Actions -->
         <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 pt-4 border-t border-gray-200"><button type="submit" class="bg-green-600 text-white px-5 py-2.5 rounded-lg text-xs md:text-sm font-medium hover:bg-green-700 transition"> <i class="fas fa-save mr-2"></i> Simpan Artikel </button> <button type="button" onclick="closeEditor()" class="bg-gray-200 text-gray-700 px-5 py-2.5 rounded-lg text-xs md:text-sm font-medium hover:bg-gray-300 transition"> Batal </button>
         </div>
        </div>
       </form>
      </div>
     </div><!-- Comments View -->
     <div id="comments-view" class="hidden">
      <div class="bg-white rounded-lg border border-gray-200 p-4 md:p-6">
       <h3 class="text-base md:text-lg font-bold text-gray-900 mb-4">Semua Komentar</h3>
       <div id="all-comments-list" class="space-y-3 md:space-y-4"><!-- Comments will be rendered here -->
       </div>
      </div>
     </div>
    </div>
   </main>
  </div>
  <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBwmiVnWL1nZ09InaKPyGb33EHVufcub2U",
            authDomain: "fir-6a3d1.firebaseapp.com",
            databaseURL: "https://fir-6a3d1-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "fir-6a3d1",
            storageBucket: "fir-6a3d1.firebasestorage.app",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:f394703a309a0e8202ce75",
            measurementId: "G-Y1PVBSMWFP"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();
        const articlesRef = database.ref('articles');
        const commentsRef = database.ref('comments');

        let articles = [];
        let allComments = [];
        let currentEditId = null;

        const defaultConfig = {
            admin_title: "Admin Dashboard"
        };

        // Listen to Firebase real-time updates
        articlesRef.on('value', (snapshot) => {
            const data = snapshot.val();
            articles = data ? Object.keys(data).map(key => ({
                id: key,
                ...data[key]
            })) : [];
            
            updateDashboard();
            renderArticlesList();
        });

        commentsRef.on('value', (snapshot) => {
            const data = snapshot.val();
            const commentsArray = [];
            
            if (data) {
                Object.keys(data).forEach(articleId => {
                    const articleComments = data[articleId];
                    Object.keys(articleComments).forEach(commentId => {
                        commentsArray.push({
                            id: commentId,
                            articleId: articleId,
                            ...articleComments[commentId]
                        });
                    });
                });
            }
            
            allComments = commentsArray;
            renderAllComments();
        });

        function updateDashboard() {
            const totalArticles = articles.length;
            const published = articles.filter(a => a.status === 'published').length;
            const totalViews = articles.reduce((sum, a) => sum + (a.views || 0), 0);
            const totalComments = articles.reduce((sum, a) => sum + (a.comments || 0), 0);

            document.getElementById('stat-total-articles').textContent = totalArticles;
            document.getElementById('stat-published').textContent = published;
            document.getElementById('stat-views').textContent = totalViews;
            document.getElementById('stat-comments').textContent = totalComments;

            renderRecentArticles();
        }

        function renderRecentArticles() {
            const container = document.getElementById('recent-articles');
            const recent = [...articles].sort((a, b) => new Date(b.timestamp || 0) - new Date(a.timestamp || 0)).slice(0, 5);

            if (recent.length === 0) {
                container.innerHTML = '<p class="text-xs md:text-sm text-gray-500 text-center py-4">Belum ada artikel</p>';
                return;
            }

            container.innerHTML = recent.map(article => `
                <div class="flex items-center justify-between py-3 border-b border-gray-100 last:border-0">
                    <div class="flex-1 min-w-0">
                        <h4 class="text-xs md:text-sm font-semibold text-gray-900 mb-1 truncate">${article.title}</h4>
                        <div class="flex flex-wrap items-center gap-2 md:gap-3 text-xs text-gray-500">
                            <span>${article.category}</span>
                            <span class="hidden sm:inline">•</span>
                            <span class="hidden sm:inline">${article.date}</span>
                        </div>
                    </div>
                    <span class="status-badge ${article.status === 'published' ? 'status-published' : 'status-draft'} ml-2 flex-shrink-0">
                        ${article.status === 'published' ? 'Published' : 'Draft'}
                    </span>
                </div>
            `).join('');
        }

        function renderArticlesList() {
            const container = document.getElementById('articles-list');
            const statusFilter = document.getElementById('status-filter')?.value || 'all';
            const categoryFilter = document.getElementById('category-filter-admin')?.value || 'all';

            let filtered = articles;
            if (statusFilter !== 'all') {
                filtered = filtered.filter(a => a.status === statusFilter);
            }
            if (categoryFilter !== 'all') {
                filtered = filtered.filter(a => a.category === categoryFilter);
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 md:py-12 bg-white rounded-lg border border-gray-200">
                        <i class="fas fa-inbox text-4xl md:text-5xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500 text-xs md:text-sm">Tidak ada artikel</p>
                    </div>
                `;
                return;
            }

            const sorted = [...filtered].sort((a, b) => new Date(b.timestamp || 0) - new Date(a.timestamp || 0));

            container.innerHTML = sorted.map(article => `
                <div class="card bg-white rounded-lg overflow-hidden fade-in">
                    <div class="flex flex-col sm:flex-row gap-3 md:gap-4">
                        ${article.thumbnail ? `
                        <div class="w-full sm:w-32 md:w-40 h-32 sm:h-auto flex-shrink-0">
                            <img src="${article.thumbnail}" alt="${article.title}" class="w-full h-full object-cover" onerror="this.parentElement.style.display='none'">
                        </div>
                        ` : ''}
                        <div class="flex-1 p-4 md:p-5 ${article.thumbnail ? 'pt-0 sm:pt-5' : ''}">
                            <div class="flex flex-col sm:flex-row items-start justify-between gap-3">
                                <div class="flex-1 w-full min-w-0">
                                    <div class="flex flex-wrap items-center gap-2 mb-2">
                                        <span class="status-badge ${article.status === 'published' ? 'status-published' : 'status-draft'}">
                                            ${article.status === 'published' ? 'Published' : 'Draft'}
                                        </span>
                                        <span class="text-xs text-gray-500">${article.category}</span>
                                    </div>
                                    <h3 class="text-sm md:text-lg font-semibold text-gray-900 mb-2">${article.title}</h3>
                                    <p class="text-xs md:text-sm text-gray-600 mb-3 line-clamp-2">${article.excerpt}</p>
                                    <div class="flex flex-wrap items-center gap-2 md:gap-4 text-xs text-gray-500">
                                        <span class="flex items-center gap-1"><i class="fas fa-user-circle"></i><span class="hidden sm:inline">${article.author}</span></span>
                                        <span class="hidden sm:flex items-center gap-1"><i class="fas fa-calendar"></i>${article.date}</span>
                                        <span class="flex items-center gap-1"><i class="fas fa-eye"></i>${article.views || 0}</span>
                                        <span class="flex items-center gap-1"><i class="fas fa-comment"></i>${article.comments || 0}</span>
                                    </div>
                                </div>
                                <div class="flex sm:flex-col items-center gap-2 w-full sm:w-auto">
                                    <button onclick="showEditor('edit', '${article.id}')" class="flex-1 sm:flex-initial text-green-600 hover:text-green-700 px-3 py-2 border border-green-200 rounded-lg text-xs hover:bg-green-50 transition" title="Edit">
                                        <i class="fas fa-edit mr-1"></i><span>Edit</span>
                                    </button>
                                    <button onclick="deleteArticle('${article.id}')" class="flex-1 sm:flex-initial text-red-600 hover:text-red-700 px-3 py-2 border border-red-200 rounded-lg text-xs hover:bg-red-50 transition" title="Hapus">
                                        <i class="fas fa-trash mr-1"></i><span>Hapus</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderAllComments() {
            const container = document.getElementById('all-comments-list');
            
            if (allComments.length === 0) {
                container.innerHTML = '<p class="text-xs md:text-sm text-gray-500 text-center py-4">Belum ada komentar</p>';
                return;
            }

            const sorted = [...allComments].sort((a, b) => new Date(b.timestamp || 0) - new Date(a.timestamp || 0));

            container.innerHTML = sorted.map(comment => {
                const article = articles.find(a => a.id === comment.articleId);
                return `
                    <div class="border-l-2 border-green-600 pl-3 md:pl-4 py-3 bg-gray-50 rounded">
                        <div class="flex items-start justify-between gap-3 md:gap-4 mb-2">
                            <div class="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2 flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-user-circle text-green-600 text-base md:text-lg"></i>
                                    <span class="font-semibold text-gray-900 text-xs md:text-sm truncate">${comment.name}</span>
                                </div>
                                <span class="text-gray-400 text-xs hidden sm:inline">•</span>
                                <span class="text-gray-500 text-xs">${comment.date}</span>
                            </div>
                            <button onclick="deleteComment('${comment.articleId}', '${comment.id}')" class="text-red-600 hover:text-red-700 text-xs md:text-sm flex-shrink-0">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <p class="text-xs md:text-sm text-gray-700 mb-2">${comment.text}</p>
                        ${article ? `<p class="text-xs text-gray-500"><i class="fas fa-newspaper mr-1"></i>Pada: <span class="truncate inline-block max-w-full">${article.title}</span></p>` : ''}
                    </div>
                `;
            }).join('');
        }

        function showView(view) {
            // Hide all views
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('articles-view').classList.add('hidden');
            document.getElementById('editor-view').classList.add('hidden');
            document.getElementById('comments-view').classList.add('hidden');

            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));

            // Show selected view
            if (view === 'dashboard') {
                document.getElementById('dashboard-view').classList.remove('hidden');
                document.getElementById('page-title').textContent = 'Dashboard';
                document.querySelectorAll('.nav-item')[0].classList.add('active');
            } else if (view === 'articles') {
                document.getElementById('articles-view').classList.remove('hidden');
                document.getElementById('page-title').textContent = 'Kelola Artikel';
                document.querySelectorAll('.nav-item')[1].classList.add('active');
            } else if (view === 'comments') {
                document.getElementById('comments-view').classList.remove('hidden');
                document.getElementById('page-title').textContent = 'Kelola Komentar';
                document.querySelectorAll('.nav-item')[2].classList.add('active');
            }

            // Close sidebar on mobile after navigation
            if (window.innerWidth < 768) {
                toggleSidebar();
            }
        }

        function showEditor(mode, articleId = null) {
            currentEditId = articleId;
            
            document.getElementById('articles-view').classList.add('hidden');
            document.getElementById('editor-view').classList.remove('hidden');
            document.getElementById('page-title').textContent = mode === 'new' ? 'Tambah Artikel' : 'Edit Artikel';
            document.getElementById('editor-title').textContent = mode === 'new' ? 'Tambah Artikel Baru' : 'Edit Artikel';

            if (mode === 'edit' && articleId) {
                const article = articles.find(a => a.id === articleId);
                if (article) {
                    document.getElementById('article-title').value = article.title;
                    document.getElementById('article-category').value = article.category;
                    document.getElementById('article-author').value = article.author;
                    document.getElementById('article-excerpt').value = article.excerpt;
                    document.getElementById('article-thumbnail').value = article.thumbnail || '';
                    document.getElementById('article-content').innerHTML = article.content;
                    document.getElementById('article-status').value = article.status;
                    
                    // Show thumbnail preview if exists
                    if (article.thumbnail) {
                        document.getElementById('thumbnail-preview-img').src = article.thumbnail;
                        document.getElementById('thumbnail-preview').classList.remove('hidden');
                    }
                }
            } else {
                document.getElementById('article-form').reset();
                document.getElementById('article-content').innerHTML = '<p>Tulis konten artikel di sini...</p>';
                document.getElementById('thumbnail-preview').classList.add('hidden');
            }

            // Scroll to top on mobile
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function closeEditor() {
            document.getElementById('editor-view').classList.add('hidden');
            document.getElementById('articles-view').classList.remove('hidden');
            document.getElementById('page-title').textContent = 'Kelola Artikel';
            currentEditId = null;
            
            // Reset thumbnail preview
            document.getElementById('thumbnail-preview').classList.add('hidden');
        }

        // Thumbnail preview handler
        document.addEventListener('DOMContentLoaded', function() {
            const thumbnailInput = document.getElementById('article-thumbnail');
            const thumbnailPreview = document.getElementById('thumbnail-preview');
            const thumbnailPreviewImg = document.getElementById('thumbnail-preview-img');
            
            if (thumbnailInput) {
                thumbnailInput.addEventListener('input', function() {
                    const url = this.value.trim();
                    if (url) {
                        let imageUrl = url;
                        
                        // Convert Google Drive share link to direct image link
                        if (url.includes('drive.google.com')) {
                            const fileIdMatch = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
                            if (fileIdMatch) {
                                imageUrl = `https://drive.google.com/uc?export=view&id=${fileIdMatch[1]}`;
                            }
                        }
                        
                        thumbnailPreviewImg.src = imageUrl;
                        thumbnailPreview.classList.remove('hidden');
                    } else {
                        thumbnailPreview.classList.add('hidden');
                    }
                });
            }
        });

        function formatText(command) {
            document.execCommand(command, false, null);
            document.getElementById('article-content').focus();
        }

        async function handleSaveArticle(e) {
            e.preventDefault();

            const title = document.getElementById('article-title').value;
            const category = document.getElementById('article-category').value;
            const author = document.getElementById('article-author').value;
            const excerpt = document.getElementById('article-excerpt').value;
            const thumbnailUrl = document.getElementById('article-thumbnail').value.trim();
            const content = document.getElementById('article-content').innerHTML;
            const status = document.getElementById('article-status').value;

            // Convert Google Drive link to direct image link
            let thumbnail = thumbnailUrl;
            if (thumbnailUrl && thumbnailUrl.includes('drive.google.com')) {
                const fileIdMatch = thumbnailUrl.match(/\/d\/([a-zA-Z0-9_-]+)/);
                if (fileIdMatch) {
                    thumbnail = `https://drive.google.com/uc?export=view&id=${fileIdMatch[1]}`;
                }
            }

            const articleData = {
                title,
                category,
                author,
                excerpt,
                thumbnail: thumbnail || '',
                content,
                status,
                date: new Date().toLocaleDateString('id-ID', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric'
                }),
                timestamp: Date.now(),
                views: currentEditId ? (articles.find(a => a.id === currentEditId)?.views || 0) : 0,
                comments: currentEditId ? (articles.find(a => a.id === currentEditId)?.comments || 0) : 0
            };

            try {
                if (currentEditId) {
                    await articlesRef.child(currentEditId).update(articleData);
                } else {
                    await articlesRef.push(articleData);
                }
                closeEditor();
            } catch (error) {
                console.error('Error saving article:', error);
            }
        }

        function deleteArticle(id) {
            const confirmed = document.createElement('div');
            confirmed.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            confirmed.innerHTML = `
                <div class="bg-white rounded-lg p-5 md:p-6 max-w-sm w-full mx-4">
                    <h3 class="text-base md:text-lg font-bold text-gray-900 mb-3">Hapus Artikel?</h3>
                    <p class="text-xs md:text-sm text-gray-600 mb-5">Artikel dan semua komentarnya akan dihapus permanen.</p>
                    <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                        <button onclick="confirmDelete('${id}')" class="flex-1 bg-red-600 text-white px-4 py-2 rounded-lg text-xs md:text-sm font-medium hover:bg-red-700">
                            Hapus
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-xs md:text-sm font-medium hover:bg-gray-300">
                            Batal
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmed);
        }

        async function confirmDelete(id) {
            try {
                await articlesRef.child(id).remove();
                await commentsRef.child(id).remove();
                document.querySelector('.fixed.inset-0').remove();
            } catch (error) {
                console.error('Error deleting article:', error);
            }
        }

        async function deleteComment(articleId, commentId) {
            try {
                await commentsRef.child(`${articleId}/${commentId}`).remove();
                
                const article = articles.find(a => a.id === articleId);
                if (article) {
                    const newCount = Math.max(0, (article.comments || 0) - 1);
                    await articlesRef.child(articleId).update({ comments: newCount });
                }
            } catch (error) {
                console.error('Error deleting comment:', error);
            }
        }

        function filterArticles() {
            renderArticlesList();
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
        }

        async function onConfigChange(config) {
            // Config changes can be handled here if needed
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["admin_title", config.admin_title || defaultConfig.admin_title]
            ]);
        }

        (function init() {
            if (window.elementSdk) {
                window.elementSdk.init({
                    defaultConfig,
                    onConfigChange,
                    mapToCapabilities,
                    mapToEditPanelValues
                });
            }
        })();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b47142b010ba090',t:'MTc2NjgyMDI3Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
